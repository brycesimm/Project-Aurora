<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:models="clr-namespace:Aurora.Shared.Models;assembly=Aurora.Shared"
             xmlns:local="clr-namespace:Aurora"
             x:Class="Aurora.MainPage"
             BackgroundColor="#F0F0F0">

    <!-- Removed outer ScrollView to prevent scroll conflict -->
    <CollectionView ItemsSource="{Binding DailyPicks}" 
                    x:DataType="local:MainPage"
                    SelectionMode="None">
        
        <!-- The "Header" scrolls with the list, acting as our top section -->
        <CollectionView.Header>
            <VerticalStackLayout Padding="20" Spacing="25">
                <Border Padding="15" StrokeShape="RoundRectangle 10" StrokeThickness="0" Background="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Gray600}}">
                    <Border.Shadow>
                        <Shadow Brush="Black" Offset="5,5" Radius="10" Opacity="0.1" />
                    </Border.Shadow>
                    <VerticalStackLayout Spacing="10">
                        <Label
                            Text="Vibe of the Day"
                            FontSize="Large"
                            FontAttributes="Bold"
                            TextColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource Secondary}}" />
                        
                        <!-- Dynamic Vibe Content -->
                        <Label
                            Text="{Binding VibeOfTheDay.Title}"
                            FontSize="Medium"
                            FontAttributes="Bold"
                            TextColor="{AppThemeBinding Light={StaticResource Gray900}, Dark={StaticResource White}}" />
                        <Image
                            Source="{Binding VibeOfTheDay.ImageUrl}"
                            Aspect="AspectFill"
                            HeightRequest="150"
                            HorizontalOptions="Fill" />
                        <Label
                            Text="{Binding VibeOfTheDay.Snippet}"
                            FontSize="Medium"
                            TextColor="{AppThemeBinding Light={StaticResource Gray900}, Dark={StaticResource White}}" />

                        <HorizontalStackLayout Spacing="15">
                            <Button 
                                x:Name="ReactionButton"
                                Text="{Binding VibeOfTheDay.UpliftCount, StringFormat='Uplifted Me ({0})'}"
                                Clicked="OnReactionButtonClicked">
                                <Button.ImageSource>
                                    <FontImageSource 
                                        FontFamily="MDI"
                                        Glyph="&#xF02D5;"
                                        Color="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Black}}" />
                                </Button.ImageSource>
                            </Button>
                            
                            <Button 
                                x:Name="ShareVibeButton"
                                Text="Share"
                                Clicked="OnShareClicked">
                                <Button.ImageSource>
                                    <FontImageSource 
                                        FontFamily="MDI"
                                        Glyph="&#xF0497;"
                                        Color="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Black}}" />
                                </Button.ImageSource>
                            </Button>
                        </HorizontalStackLayout>
                    </VerticalStackLayout>
                </Border>
                
                <Label Text="Daily Picks" 
                       FontSize="Large" 
                       FontAttributes="Bold" 
                       Margin="0,10,0,0"
                       TextColor="{AppThemeBinding Light={StaticResource Gray900}, Dark={StaticResource White}}"/>
            </VerticalStackLayout>
        </CollectionView.Header>

        <!-- The List Items -->
        <CollectionView.ItemTemplate>
            <DataTemplate x:DataType="models:ContentItem">
                <VerticalStackLayout Padding="20,0,20,15">
                    <Border Padding="15" StrokeShape="RoundRectangle 10" StrokeThickness="0" Background="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Gray600}}">
                        <Border.Shadow>
                            <Shadow Brush="Black" Offset="5,5" Radius="10" Opacity="0.1" />
                        </Border.Shadow>
                        <VerticalStackLayout Spacing="5">
                            <Label
                                Text="{Binding Title}"
                                FontSize="Medium"
                                FontAttributes="Bold"
                                TextColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource Secondary}}" />
                            <Label
                                Text="{Binding Snippet}"
                                FontSize="Small"
                                TextColor="{AppThemeBinding Light={StaticResource Gray900}, Dark={StaticResource White}}" />
                            
                            <HorizontalStackLayout Spacing="15" Margin="0,10,0,0">
                                <Button 
                                    Text="{Binding UpliftCount, StringFormat='Uplifted Me ({0})'}"
                                    Clicked="OnReactionButtonClicked">
                                    <Button.ImageSource>
                                        <FontImageSource 
                                            FontFamily="MDI"
                                            Glyph="&#xF02D5;"
                                            Color="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Black}}" />
                                    </Button.ImageSource>
                                </Button>

                                <Button 
                                    Text="Share"
                                    Clicked="OnShareClicked">
                                    <Button.ImageSource>
                                        <FontImageSource 
                                            FontFamily="MDI"
                                            Glyph="&#xF0497;"
                                            Color="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Black}}" />
                                    </Button.ImageSource>
                                </Button>
                            </HorizontalStackLayout>
                        </VerticalStackLayout>
                    </Border>
                </VerticalStackLayout>
            </DataTemplate>
        </CollectionView.ItemTemplate>
    </CollectionView>

</ContentPage>